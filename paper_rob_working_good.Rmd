---
title: "waRne - Putting cricket analytics in a spin"
authors: "unknown 1", "unknown 2"
output:
  pdf_document:
    toc: no
  html_document:
    toc: yes
    toc_float: yes
    keep_md: yes
  word_document:
    toc: yes
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = TRUE, warning = TRUE)
library(tidyverse)
player_database <- 
  read_csv("data/new_player_database_crickjam (2).csv") %>% 
  dplyr::select(player_id, player_name, batting_style, bowling_style) %>% 
  dplyr::distinct() %>% 
  dplyr::filter(player_name != "Rohit Gurunath Sharma") %>% 
  dplyr::bind_rows(read_csv("data/new_player_database_crickjam (2).csv") %>% 
              dplyr::filter(player_id == 34102) %>% 
              dplyr::select(player_id, player_name, batting_style, bowling_style) %>% 
              drop_na() %>% 
              dplyr::distinct()) %>% 
  dplyr::filter(player_name !="Sultan Ahmed") 


bowler_vars <- 
  player_database %>% 
  dplyr::select(-c(batting_style, player_name)) %>% 
  drop_na()%>% 
 dplyr:: mutate(pace_spin = case_when(bowling_style == "Right-arm fast" ~ "Pace",
                                bowling_style == "Slow left-arm orthodox"~ "Spin",
                                bowling_style == "Legbreak"~ "Spin",
                                bowling_style == "Right-arm medium"~ "Pace",
                                bowling_style == "Left-arm medium-fast"~ "Pace",
                                bowling_style == "Right-arm offbreak"~ "Spin",
                                bowling_style == "Legbreak googly"~"Spin",
                                bowling_style == "Left-arm fast"~ "Pace",
                                bowling_style == "Right-arm medium-fast"~ "Pace",
                                bowling_style == "Left-arm fast-medium"~ "Pace",
                                bowling_style == "Right-arm fast-medium"~ "Pace",
                                bowling_style == "Left-arm medium"~ "Pace",
                                bowling_style == "Slow left-arm chinaman"~ "Spin",
                                bowling_style == "Right-arm offbreak, Legbreak"~ "Spin",
                                bowling_style == "Right-arm medium, Right-arm offbreak"~ "Spin",
                                bowling_style == "Left-arm medium, Slow left-arm orthodox, 
                                               Slow left-arm chinaman"~ "Spin", 
                                bowling_style == "Left-arm medium, Slow left-arm orthodox, Slow left-arm chinaman" ~ "Spin"))

batting_vars <- 
  player_database %>% 
  dplyr::select(-c(bowling_style, player_name)) %>%
  drop_na() 

cricjam_data <- 
  read_csv("data/combined_2020_09_11.csv") %>% 
  dplyr::filter(!grepl("No result", match_summary)) %>%
  mutate(bucketed_year = if_else(nchar(year)==4, year, as.numeric(str_sub(as.character(year), 1, 4)))) %>% 
  left_join(batting_vars, by = c("batsman_id" = "player_id")) %>% 
  left_join(bowler_vars, by = c("bowler_id" = "player_id")) %>% 
  mutate(batsman_name = str_remove(batsman_name, "\\(\\)"), 
         batsman_name = str_trim(batsman_name), 
         runs = extra_runs+earned_runs)
# 
# cricjam_data_partner <- 
#   cricjam_data %>% 
#   dplyr::select(match_id, inning, batsman_name, batsman_id, batting_order) %>% 
#   distinct() %>% 
#   arrange(batting_order) %>% View()

wicket_types <-
  cricjam_data %>% 
  dplyr::filter(wicket==TRUE) %>% 
  dplyr::select(wicket_description, play_description, bowler, batsman, bowler_name, batsman_name, 
                match_id, inning, over) %>%
  mutate(caught_out = if_else(str_detect(wicket_description, " c "), TRUE, FALSE), 
         bowled_out = if_else(str_detect(wicket_description, " b "), TRUE, FALSE), 
         run_out = if_else(str_detect(wicket_description, " run out "), TRUE, FALSE), 
         stumped_out = if_else(str_detect(wicket_description, " st "), TRUE, FALSE), 
         leg_before_wicket = if_else(str_detect(wicket_description, " lbw "), TRUE, FALSE), 
         retired_hurt = if_else(str_detect(wicket_description, " retired hurt "), TRUE, FALSE), 
         obstructing_the_field = if_else(str_detect(wicket_description, " obstructing the field "), TRUE, FALSE), 
         retired_out = if_else(str_detect(wicket_description, " retired out "), TRUE, FALSE), 
         null = if_else(str_detect(wicket_description, " null "), TRUE, FALSE)) %>% 
  # all_conditions = if_else(caught_out == TRUE |
  #                          bowled_out == TRUE | caught_out == TRUE |
  #                            run_out == TRUE |retired_out == TRUE |
  #                            retired_hurt == TRUE |leg_before_wicket == TRUE |
  #                            obstructing_the_field == TRUE |null == TRUE |
  #                            stumped_out == TRUE, TRUE, FALSE))
  mutate(out_condition = case_when(caught_out==TRUE |
                                     caught_out==TRUE & bowled_out == TRUE ~ "Caught", 
                                   run_out == TRUE |
                                     run_out==TRUE & bowled_out == TRUE ~ "Run Out", 
                                   stumped_out == TRUE |
                                     stumped_out==TRUE & bowled_out == TRUE ~ "Stumped", 
                                   leg_before_wicket == TRUE |
                                     leg_before_wicket==TRUE & bowled_out == TRUE ~ "Leg Before Wicket", 
                                   retired_hurt == TRUE |
                                     retired_hurt==TRUE & bowled_out == TRUE ~ "Retired Hurt", 
                                   obstructing_the_field == TRUE |
                                     obstructing_the_field==TRUE & bowled_out == TRUE ~ "Obstructing the Field", 
                                   retired_out == TRUE |
                                     retired_out==TRUE & bowled_out == TRUE ~ "Retired Out", 
                                   null == TRUE |
                                     null==TRUE & bowled_out == TRUE ~ "Caught", 
                                   bowled_out == TRUE & caught_out == FALSE |
                                     bowled_out == TRUE & stumped_out == FALSE |
                                     bowled_out == TRUE & run_out == FALSE |
                                     bowled_out == TRUE & leg_before_wicket == FALSE |
                                     bowled_out == TRUE & retired_hurt == FALSE |
                                     bowled_out == TRUE & obstructing_the_field == FALSE |
                                     bowled_out == TRUE & retired_out == FALSE |
                                     bowled_out == TRUE & null == FALSE ~"Bowled"), 
         out_batsman = case_when(out_condition == "Bowled" ~ word(wicket_description, 1, sep = " b "), 
                                 out_condition == "Caught" & null == FALSE ~ word(wicket_description, 1, sep = " c "), 
                                 out_condition == "Caught" & null == TRUE ~ word(wicket_description, 1, sep = " null "), 
                                 out_condition == "Run Out" ~ word(wicket_description, 1, sep = " run out "), 
                                 out_condition == "Stumped" ~ word(wicket_description, 1, sep = " st "), 
                                 out_condition == "Leg Before Wicket" ~ word(wicket_description, 1, sep = " lbw "), 
                                 out_condition == "Retired Hurt" ~ word(wicket_description, 1, sep = " retired hurt "), 
                                 out_condition == "Obstructing the Field" ~ word(wicket_description, 1, sep = " obstructing the field "), 
                                 out_condition == "Retired Out" ~ word(wicket_description, 1, sep = " retired out ")),  
         out_batsman = str_trim(out_batsman)) %>% 
  dplyr::select(-c(caught_out, bowled_out, stumped_out, leg_before_wicket, retired_hurt, 
                   obstructing_the_field, retired_hurt, null, run_out, retired_out)) %>% 
  mutate(batsman_or_partner_out = if_else(out_batsman == batsman_name, "Batsman","Partner"))

cricjam_data <- 
  cricjam_data %>% 
  left_join(wicket_types, by = c("wicket_description" = "wicket_description", 
                                 "play_description" = "play_description", 
                                 "bowler" = "bowler", 
                                 "batsman" = "batsman", 
                                 "batsman_name" = "batsman_name", 
                                 "match_id" = "match_id", 
                                 "inning" = "inning", 
                                 "over" = "over", 
                                 "bowler_name" = "bowler_name")) %>% 
  rename(inning_summary = inning_total)


only_big_t20_matches <- 
  cricjam_data %>% 
  dplyr::filter(tournament_type == "Twenty20", 
                tournament_name %in% c("Twenty20 Big Bash", "Indian Premier League", "Big Bash League", 
                                       "Champions League Twenty20", "Pepsi Indian Premier League")) %>% 
  dplyr::select(match_id) %>% 
  distinct() %>% 
  pull(match_id) 

cricjam_data_big <- 
  cricjam_data %>% 
  dplyr::filter(tournament_type == "Twenty20 Internationals") %>% 
  bind_rows(cricjam_data %>% 
              dplyr::filter(match_id %in% only_big_t20_matches))
```

```{r libraries, include=FALSE}
library(tidyverse)
library(naniar)
library(visdat)
library(patchwork)
library(cowplot)

```

## Abstract

The importance of reproducibility, and the related issue of open access to data, has received a lot of recent attention. Momentum on these issues is gathering in the sports analytics community. While cricket is the second largest commercial sport in the world, unlike other popular international sports, there has been no mechanism for the public to access comprehensive statistics on players and teams. Expert commentary currently relies heavily on data that isn't made readily accessible and this produces an unnecessary barrier for the development of an inclusive sports analytics community.

## Introduction

Data access is a key enabler for any analytics community. Most major sports have easy access to match statistics, for example [nbastatR](https://github.com/abresler/nbastatR) for NBA, [Lahman](https://cran.r-project.org/web/packages/Lahman/Lahman.pdf) for baseball, [deuce](https://github.com/skoval/deuce) for tennis and [nflfastR](https://github.com/mrcaseb/nflfastR) for NFL. Through access to sports data and reproducible findings and metrics fans clubs and researchers are better able to understand the game, predict match outcomes and rate players. For example the way teams tackled 4th down decisions in the NFL has changed since [@romer2006firms] seminial work. As teams have changed their 4th down decision making this allows follow up research such as [@yam2019lost] which looked at more granular data to see if this happens in practice.

By making data available more advanced metrics have become more accessible to  fans through quality data journalists. For example in [@horowitz2017nflscrapr] has enabled EPA to enter popular discussion among fans
^[https://twitter.com/minakimes/status/1205591497497817089]
^[https://twitter.com/KevinColePFF/status/1277974109175951368].

Cricket is the second largest sport in the world. However, unfortunately there is no easy accessible way to access ball by ball data nor aggregated statistics of teams and players. Data while available on sites like [espncricinfo](https://www.espncricinfo.com/) are not in an easy to use form. For example, each match is listed on different webpages so hours upon hours of time would be required to copy and paste a single season, not to mention the added difficulty of linking players between games and competitions in different countries. Hence, there are significant logistical barriers for prospective fans and analysts studying the game, which stagnates understanding of cricket.

This paper describes the waRne package, the first to provide free and easy access to data for cricket for fans. Web scraping tools are available for fans to easily scrape the play by play commentary data on [espncricinfo](https://www.espncricinfo.com/). For the first time fans can evaluate their favourite teams and players and do so in a reproducible and accessible manner. We hope that this package can be used for fans to better understand the game, for teachers to use for interesting examples in class and for analysts in clubs who might not have access to ball by ball data.

## Why cricket needs reproducibility

Data accessibility enables fans, analysts and researchers to better understand the game. Through being able to reproduce, fans are able to make accessible findings for others and importantly they are able to extend and grow concepts. Unfortunately what we see through leading cricket analytics providers is a track record of confusing output for fans. This can lead to lower engagement and dismissal of cricket analytics.

For example in this [series of tweets](https://twitter.com/benjonescricket/status/1219898578719723520) we see the narrative being pushed that Steve Smith is a good player vs pace bowling unfortunately just a few months prior the same company and journalist published an article which had Steve Smith doing much worse against pace (balls above 140km/h). Unlike a similar sport baseball, fans have no easily accessible way of seeing if Steve Smith vs pace is a strength as alluded to in the original tweet, or a weakness like the same persons published online article. In comparison, fans are able to get a breakdown of Mike Trout vs fastballs from using [baseballr](https://billpetti.github.io/2018-02-19-build-statcast-database-rstats/) which provides access through [statcast](http://m.mlb.com/glossary/statcast) data from [baseballsavant](https://baseballsavant.mlb.com/).

```{r, echo=FALSE, warning=FALSE,message=FALSE,out.width = "80%",fig.align='center'}
p1<-cricjam_data_big %>% 
	dplyr::filter(batsman_id == 267192, 
								!is.na(pace_spin)) %>% 
	group_by(pace_spin, earned_runs) %>% 
	summarise(total = n()) %>% 
	group_by(pace_spin) %>% 
	mutate(totals = sum(total),
				 percent = total/totals, 
				 earned_runs = as.factor(earned_runs)) %>% 
	ggplot(aes(y = pace_spin, x = percent, color = earned_runs))+
	geom_point() +
	labs(color = "Runs", 
			 x = "% Balls Faced", 
			 y = "Bowling Style", 
			 title = "Steve Smith's Distribution of Runs Against Spin V Pace")
p1 +theme_minimal()

```

Another barrier for fans to engage in analytics is the inability to look up insights around their favourite players, for cricket many fans have to take insights as standalone facts, without the ability to explore other players who might be of interest. For example after seeing this [tweet](https://twitter.com/cricvizanalyst/status/1311260989267087361) fans might want to know how their favourite player goes against various types of bowling. This is in stark contrast to other major sports like the NFL whereby some of the leading analytical writers make their insights more accessible by sharing code^[https://www.opensourcefootball.com/posts/2020-09-09-creating-an-expected-field-goal-metric/] and data sources.^[https://twitter.com/ChiefsAnalytics/status/1310758685325455360]
^[https://twitter.com/ChiefsAnalytics/status/1307839100896948230]
^[https://twitter.com/benbbaldwin/status/1311344809823657985]. 



```{r, echo=FALSE, message=FALSE,warning=FALSE,out.width = "80%",fig.align='center'}

p1<-cricjam_data_big %>% 
	dplyr::filter(batsman_id == 267192, 
								!is.na(pace_spin)) %>% 
	group_by(pace_spin, earned_runs) %>% 
	summarise(total = n()) %>% 
	group_by(pace_spin) %>% 
	mutate(totals = sum(total),
				 percent = total/totals, 
				 earned_runs = as.factor(earned_runs)) %>% 
	ggplot(aes(y = pace_spin, x = percent, color = earned_runs))+
	geom_point() +
	labs(color = "Runs", 
			 x = "% Balls Faced", 
			 y = "Bowling Style", 
			 title = "Steve Smith's Distribution of Runs Against Spin V Pace")

rpo_players <- c(
	# 230559, #pollard
	# 34102, #rohit sharma
	33335, #suresh raina
	28235, #siihkar dhawan
  # 32498, #yusef pathan
  # 321777, #david miller
  # 44936, #AB De Villiers
  # 276298, #andre russell
  # 8180, #shane watson
  34102, #rohit sharma
  # 51880, #gayle
  # 325012, #stoinis
  # 272450, #MR Marsh
  # 28081, #Dhoni
  253802, #kholi
  # 5334, #finch
  219889 #warner
  # 326434, #carey
  # 267192, #smith
  # 505120, #agar
  # 530011, #head
  # 5961, #henriques
  # 325026 #maxwell
  # 25913, #nabu
  # 4864, #christian,
  # 270484, #faulkner
  # 230193, #wade
  # 233680, #wells
  # 500268, #turner
  # 334337, #handscomb
  # 603410, #mcdermott
  # 308798  #short
  # 787987, #labuschagne
  # 1124282, # josh phillipe
  # 326637, #Chris Lyrnn
  # 5939, #hussey
  # 931581 #pant
  # 308967, # job buttler
  # 249866  # alex hales
)
	
p2<-cricjam_data_big %>% 
	dplyr::filter(batsman_id %in% rpo_players, 
								!is.na(pace_spin)) %>% 
	group_by(pace_spin, batsman_name) %>% 
	mutate(rpo = sum(runs)/n()*6) %>% 
	dplyr::summarise(mean_rpo = mean(rpo)) %>% 
	ggplot(aes(x = mean_rpo, y = batsman_name, color = pace_spin))+
	geom_point() +
	theme_minimal()+
	labs(x = "RPO", 
			 title = "RPO By Bowling Style", 
			 y = "", 
			 color = "")

# plot_grid(p1,p2, labels=c("",""))
p2 +theme_minimal()

	
```

Without accessible data and a mechanism to get the data easily into peoples hands, how can cricket experience the growth that the NFL has throughout the past few years^[https://www.samford.edu/sports-analytics/fans/2020/The-Future-of-NFL-Data-Analytics]. Through waRne, we hope to get the ball rolling on changing things for the cricket community. Fans of cricket might be interested to see if their own favourite players perform different against spin vs pace bowling, they might want to explore a different subset of players runs per over. 

## Using waRne for teaching statistics and [tidyverse](https://www.tidyverse.org/learn/)


We can also use waRne and other R packages as an easy way to engage students in learning statistical concepts.

For example,a common classroom example for learning the binomial distribution is to ask if a coin is based given a proportion of heads and tails given a sample size [@mcelreath2020statistical]. Instead of asking about coins, fans of sport and cricket might be interested to ask the question; after winning the coin toss, should a team decide to bat first or bat second [@kvam2004teaching].

While a coin toss is a seemingly trivial example, like in most professional sports the winner of the coin toss gets to decide what to do. In cricket, the winner of the coin toss gets to decide if they want to bat first and thus set the total that the opposition needs to pass by a single run to win, or if they want to bowl first and thus chase down the total set. Deciding what to do after winning a coin toss has proved to be a popular media piece in recent years
^[https://www.espncricinfo.com/story/_/id/21489056/stuart-wark-cricket-move-away-coin-toss]
^[https://www.espncricinfo.com/video/clip/\_/id/23230682%5D]
^[https://www.espncricinfo.com/story/\_/id/20429499/lehmann-backs-scrapping-toss]
^[https://www.espncricinfo.com/story/\_/id/28770755/how-much-does-losing-tosses-impact-visiting-teams]
^[https://www.forbes.com/sites/tristanlavalette/2018/08/20/are-cricket-matches-being-decided-by-the-luck-of-a-coin-toss/#735456837eff]
^[https://www.statsinsider.com.au/bbl/how-important-is-winning-the-toss-in-the-big-bash-league]
^[https://www.espncricinfo.com/story/_/id/18568387/tim-wigmore-how-batting-second-become-more-fruitful-more-popular]

Fans of cricket, instead of being mislead by [small samples](https://www.espncricinfo.com/story/_/id/30010174/kkr-vs-rr-ipl-2020-talking-points-why-teams-bowling-first?-did-andre-russell-promotion-work)^[This article, has 6 matches being considered overwhelming evidence] might want to instead do a statistical test or visualise if batting first has a difference in terms of winning percentages and is this consistent across leagues.





```{r, echo=FALSE, warning=FALSE, message=FALSE,out.width = "80%",fig.align='center'}
library(broom)
cricjam_data_big %>% 
	dplyr::filter(inning == 1, 
								batting_team_result != "super-over") %>% 
	dplyr::filter(tournament_type == "Twenty20", 
                tournament_name %in% c("Twenty20 Big Bash", "Indian Premier League", "Big Bash League", 
                                       "Champions League Twenty20", "Pepsi Indian Premier League")) %>% 
	mutate(t_name = if_else(tournament_name %in% c("Big Bash League", "Twenty20 Big Bash"), "Big Bash", "IPL")) %>% 
	mutate(year = if_else(nchar(year)==4, year, as.numeric(str_sub(as.character(year), 1, 4)))) %>% 
	group_by(year, batting_team_result, t_name) %>% 
	dplyr::select(batting_team_result, match_id, year, t_name) %>% 
	distinct() %>% 
	summarise(total = n()) %>% 
	pivot_wider(names_from = batting_team_result, values_from = total) %>% 
	ungroup() %>% 
	mutate(n =win+lose, 
				 p = 0.5, 
				 alternative = "two.sided", 
				 conf.level = 0.95, 
				 x = win) %>% 
	mutate(result = pmap(list(x, n,p), binom.test)) %>% 
  # Extract results from test into dataframe using broom::tidy
  mutate(result = map(result, tidy)) %>%
  mutate(result = map(result, ~select(.x, p.value, conf.low, conf.high))) %>% 
  unnest(cols = c(result)) %>%
  # plot the annual confidence intervals
  ggplot(aes(factor(year), p.value)) + 
    geom_errorbar(aes(ymin=conf.low, ymax=conf.high, color = (p.value > 0.05)), width=.1) +
  theme_minimal() +
  labs(y = "P(Batting is fair)", x = "Year", color = "p < 0.05") +
  ggtitle("Annual 1st Inning Batting Fairness")+ 
  theme(axis.text.x=element_text(angle=-90))+
	facet_wrap(~t_name)

```

## The Yorker

The yorker is considered one of most difficult deliveries to hit for batsman for a few reasons. Yorkers are usually bowled quicker than a bowlers average pace and aimed at the batsmans feet. This makes it difficult for the batsman to get ''under'' the ball and hit it over the fence for six. By pulling the delivery type from the play description on espncricinfo, every time a yorker was bowled we have the players who bowled and batted. As yorkers are typically bowled during the closing stages of matches, we can look at how good closers such as [Dhoni](https://www.espncricinfo.com/india/content/player/28081.html) bat against them.

```{r, echo=FALSE, message=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}
middle_batsman_of_interest <- c(
  230559, #pollard
  32498, #yusef pathan
  321777, #david miller
  44936, #AB De Villiers
  276298, #andre russell
  8180, #shane watson
  34102, #rohit sharma
  28081, #Dhoni
  325026 #maxwell
  )  

cricjam_data_big %>% 
  mutate(yorker=if_else(str_detect(play_description,"york"),1,0))%>%
  select(batsman_id, earned_runs, play_description,yorker, tournament_type, batsman_name)%>%
  filter(batsman_id%in% middle_batsman_of_interest) %>% 
  group_by(earned_runs, yorker, batsman_name)%>%
  tally() %>%
  filter(yorker==1) %>% 
  ungroup() %>% 
	group_by(batsman_name) %>% 
  mutate(total = sum(n), 
         percent = n/total, 
  			 earned_runs = as.factor(earned_runs), 
  			 yorker_nah = "Yorker") %>% 
	bind_rows(cricjam_data_big %>% 
  mutate(yorker=if_else(str_detect(play_description,"york"),1,0))%>%
  select(batsman_id, earned_runs, play_description,yorker, tournament_type, batsman_name)%>%
  filter(batsman_id%in% middle_batsman_of_interest) %>% 
  group_by(earned_runs, yorker, batsman_name)%>%
  tally() %>%
  filter(yorker==0) %>% 
  ungroup() %>% 
	group_by(batsman_name) %>% 
  mutate(total = sum(n), 
         percent = n/total, 
  			 earned_runs = as.factor(earned_runs), 
  			 yorker_nah = "Non Yorker")) %>% 
	ggplot(aes(x = percent, y = batsman_name, color = earned_runs))+
	geom_point() +
	labs(color = "Runs", 
			 y = "", 
			 x = "%")+ theme_minimal()+
	facet_wrap(~yorker_nah)

```


## [Dhoni](https://www.espncricinfo.com/india/content/player/28081.html) Dilemma

With access to espncricinfo data, we allow fans to put on their analyst hats and to be able to ask themselves, what exactly makes a good closer and what exactly is the Dhoni Dilemma. 

Cricket is an obvious sort of sport, to win in the end you have to get one run more than your opposition. A commonly used statistic during the broadcast is the required run rate (RRR), for example if you need 120 to win off 20 overs your RRR is $6$ runs an over. What follows is then obvious, the chasing team wins if they are able to lower the RRR to 0.

Espncricinfo did a piece on successful T20 chases and found that teams who score a higher proportion of their needed runs in the first 10 overs did better than those who did not^[https://www.espncricinfo.com/story/_/id/26712889/t20-chases-won-lost-first-ten-overs-not-last-ten]. But proportion of team runs in T20 games doesn't really make sense as an individual batting metric as we are not just concerned with how many runs they get, but how quickly they get them. So we measure our batsmen's performances by how well they perform when there is a known target, that is in second innings only, and how they affect their teams required run rate while at bat. 

```{r,message=FALSE, echo=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}
# graph of powerplay

opening_batsman_of_interest <- c(
  # 230559, #pollard
  48472, #t dilshaan
  37737, #brendon mccalum
  8180, #shane watson
  47270, #greme smith, 
  28763, #gautham gambhir
  226492, #martn guptil
  49289, #mahela jayawardene
  56194, #tamim iqbal
  55608, #hamilton masakadza
  51880, #gayle
  41434, #mohommad hafeez
  259410, #ahmed shehzad
  24611, #william porterfield
  # 49209, #sanath jayasuriya
  43906, #hashim amla
  16406, #michael lumb
  # 42683, #salman butt
  # 325012, #stoinis
  # 272450, #MR Marsh
  # 28081, #Dhoni
  # 253802, #kholi
  5334, #finch
  219889, #warner
  # 326434, #carey
  267192, #smith
  # 505120, #agar
  # 530011, #head
  # 5961, #henriques
  # 325026, #maxwell
  # 25913, #nabu
  # 4864, #christian,
  # 270484, #faulkner
  # 230193, #wade
  # 233680, #wells
  # 500268, #turner
  # 334337, #handscomb
  # 603410, #mcdermott
  # 308798  #short
  # 787987, #labuschagne
  # 1124282, # josh phillipe
  # 326637, #Chris Lyrnn
  # 5939, #hussey
  # 931581 #pant
  308967, # jos buttler
  253802, #Kohli
  249866  # alex hales
)

# Dot plot for openers
cricjam_data_big %>% 
  dplyr::filter(inning == 2, 
                batsman_id %in% opening_batsman_of_interest, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over<6) %>% 
  group_by(batsman_name) %>% 
  summarise(change = mean(change_in_requireed_run_rate), 
            total_balls_faced = n()) %>% 
  ggplot(aes(x = total_balls_faced, y = change, label = batsman_name)) +
  geom_point(size = 2) +
  xlim(c(50, 1250))+
  geom_text(vjust = 1.4, color = "black") +
  labs(x = "Balls Faced", 
       y = "Average Change in Required Run Rate", 
       title = "Top Opening Batsmen T20 (Overs 1-6)")+
  theme_minimal()
```

This graph makes sense as we can see some of the best openers in the world lower the required run rate^[https://www.icc-cricket.com/rankings/mens/player-rankings/t20i]. So what is the Dhoni Dilemma?

Dhoni is considered the greatest closing batsman in the world^[https://www.smh.com.au/sport/cricket/australia-to-stick-with-stoinis-in-hope-he-can-be-their-dhoni-20200905-p55sqn.html]. He has pulled of many spectacular wins, and has excellent T20 and T20I strike rates after 14 years in the game. But how does his required run rate compare to other middle order and closing batsman. We compare him to some well known middle and closing batsmen from across T20 below. Starting in the middle overs where he plays most often, we compare the required run rates

```{r,message=FALSE, echo=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}
# middle overs (enter in the middle)

middle_batsman_of_interest <- c(
  230559, #pollard
  32498, #yusef pathan
  321777, #david miller
  44936, #AB De Villiers
  276298, #andre russell
  8180, #shane watson
  34102, #rohit sharma
  # 51880, #gayle
  # 325012, #stoinis
  # 272450, #MR Marsh
  28081, #Dhoni
  # 253802, #kholi
  # 5334, #finch
  # 219889, #warner
  # 326434, #carey
  # 267192, #smith
  # 505120, #agar
  # 530011, #head
  # 5961, #henriques
  325026 #maxwell
  # 25913, #nabu
  # 4864, #christian,
  # 270484, #faulkner
  # 230193, #wade
  # 233680, #wells
  # 500268, #turner
  # 334337, #handscomb
  # 603410, #mcdermott
  # 308798  #short
  # 787987, #labuschagne
  # 1124282, # josh phillipe
  # 326637, #Chris Lyrnn
  # 5939, #hussey
  # 931581 #pant
  # 308967, # job buttler
  # 249866  # alex hales
)  

cricjam_data_big %>% 
  dplyr::filter(inning == 2, 
                batsman_id %in% middle_batsman_of_interest, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # min(batsman_balls_faced_this_match)==1,
                over<16, 
                over>=6) %>% 
  group_by(batsman_id, match_id) %>% 
  mutate(min_balls = if_else(min(batsman_balls_faced_this_match)==1, 1, 0)) %>% 
  ungroup() %>% 
  # dplyr::filter(min_balls==1) %>%
  group_by(batsman_name) %>% 
	# dplyr::filter(batsman_id == 28081) %>% ggplot(aes(x = change_in_requireed_run_rate))+geom_histogram()
  summarise(change = mean(change_in_requireed_run_rate), 
            total_balls_faced = n()) %>% 
  ggplot(aes(x = total_balls_faced, y = change, label = batsman_name)) +
  geom_point() +
	xlim(c(300, 1300))+
  # geom_text(vjust = 1, color = "black") +
  labs(x = "Balls Faced", 
       y = "Average Change in Required Run Rate", 
       title = "Top Middle Batsmen T20 overs 7-16")+
  geom_text(vjust = 1.4, color = "black") +
  theme_minimal() 

```

It seems as though in the middle he is letting the game get out of hand. How can one of the worlds best closers let the required run rate go up so consistently in the middle overs?

One possible explanation comes from looking at the acceleration of Dhoni compared to these other middle order batsmen. Dhoni comes in usually around overs 11/12, and from the plot below we can see that he is a slow starter, it takes several overs for him to get his strike rate up, which consistently stays high throughout the game even when other batsmen's begins to drop off. It seems he takes a while to warm up, which explains why he comes in early in the second half.

```{r,message=FALSE, echo=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}

cricjam_data_big %>% 
    dplyr::filter(batsman_id %in% middle_batsman_of_interest, 
                  !is.infinite(required_run_rate), 
                  over>=6, 
    							# over <16
                  # batsman_id == 5961
                  # batsman_balls_faced_this_match == 1
                  ) %>% 
    # dplyr::select(over, earned_runs, play_description) %>%
    # group_by(earned_runs) %>% 
    # summarise(n())
    # group_by(batsman_id, match_id) %>% 
    # mutate(min_balls = if_else(min(batsman_balls_faced_this_match)==1, 1, 0)) %>% 
    # ungroup() %>%
    group_by(batsman_balls_faced_this_match, batsman_name) %>%  # from here to the next comment is for sr, the rest is for 
    summarise(sr = 100*sum(extra_runs+earned_runs)/n(), 
              count = n()) %>% 
    # dplyr::filter(batsman_balls_faced_this_match<50) %>% 
    ggplot(aes(x = batsman_balls_faced_this_match, y = sr)) + 
    geom_smooth() +
    geom_hline(yintercept = 120) +
    ylim(c(0,200))+
    labs(x = "Balls Faced", 
         y = "Strike Rate", 
         title = "Batsman Acceleration In Overs 11-20")+
    theme_minimal() +
     facet_wrap(~batsman_name)

```

A common theory would be that if Dhoni is lowering the required run rate himself, then during this phase of play it must be his partner who is attacking the run rate, while Dhoni aims to survive to the closing overs. However looking at Dhonis partners we see this is not the case. Thus adding to the Dhoni Dilemma.

```{r, message=FALSE,echo=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}

middle_batsman_of_interest <- c(
  230559, #pollard
  32498, #yusef pathan
  321777, #david miller
  44936, #AB De Villiers
  276298, #andre russell
  8180, #shane watson
  34102, #rohit sharma
  28081, #Dhoni
  325026 #maxwell
  )  
maxwell <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 325026, 
                inning == 2, resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Maxwell = mean(diff))  %>% 
	mutate(batsman_partner_Maxwell = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 325026, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Maxwell = if_else(batsman_id == 325026, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Maxwell) %>% 
  summarise(avg_Maxwell = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Maxwell", 
				 avg = avg_Maxwell, 
				 batsman_partner = batsman_partner_Maxwell) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


	
dhoni <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 28081, 
                inning == 2, 
  							resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Dhoni = mean(diff)) %>% 
	mutate(batsman_partner_Dhoni = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 28081, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
														resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Dhoni = if_else(batsman_id == 28081, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Dhoni) %>% 
  summarise(avg_Dhoni = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Dhoni", 
				 avg = avg_Dhoni, 
				 batsman_partner = batsman_partner_Dhoni) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


russell <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 276298, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
  							resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Russell = mean(diff)) %>% 
	mutate(batsman_partner_Russell = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 276298, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
														resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Russell = if_else(batsman_id == 276298, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Russell) %>% 
  summarise(avg_Russell = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Russell", 
				 avg = avg_Russell, 
				 batsman_partner = batsman_partner_Russell) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))




pollard <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 230559, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
  							resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,
              							resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Pollard = mean(diff)) %>% 
	mutate(batsman_partner_Pollard = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 230559, 
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                over < 16,
														resources>10,
                over >= 6 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
                            !is.infinite(required_run_rate), 
                            over < 16,resources>10,
                            over >= 6), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Pollard = if_else(batsman_id == 230559, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Pollard) %>% 
  summarise(avg_Pollard = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Pollard", 
				 avg = avg_Pollard, 
				 batsman_partner = batsman_partner_Pollard) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


pollard %>% 
	bind_rows(maxwell, dhoni, russell) %>% 
	ggplot(aes(x = bucketed_over, y = avg, group = batsman_partner, color = batsman_partner)) +
  geom_smooth()+
  geom_hline(yintercept = 0)+
  labs(y = "Required Run Rate", 
       x = "Over", 
       title = "Change in Required Run Rate While Batting (or Partnering)", 
  		 color = "")+
  facet_wrap(~batsman_name)+
  theme_minimal()

```


Finally we looked at the performance in the end of the game, overs 17-20. The required run rate is a poor metric to use here when the resources (overs and wickets) are low, so we restrict this to game situations where the [DLS](https://en.wikipedia.org/wiki/Duckworth%E2%80%93Lewis%E2%80%93Stern_method)^[The Duckworth Lewis tables are not publically accessible, through this example we hope someone somewhere will upload the tables for T20, for this example we had to use the ODI ones] resources are greater than 10. Here we can see that Dhoni is quickly lowering the required run rate, consistently to the end of the match. It appears that this is his strength, being able to at the last minute quickly lower the required run rate near the end of the game in T20


```{r,message=FALSE,echo=FALSE, warning=FALSE,out.width = "80%",fig.align='center'}

middle_batsman_of_interest <- c(
  230559, #pollard
  32498, #yusef pathan
  321777, #david miller
  44936, #AB De Villiers
  276298, #andre russell
  8180, #shane watson
  34102, #rohit sharma
  28081, #Dhoni
  325026 #maxwell
  )  
maxwell <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 325026, 
                inning == 2, 
  							resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Maxwell = mean(diff))  %>% 
	mutate(batsman_partner_Maxwell = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 325026, 
                inning == 2, 
														resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Maxwell = if_else(batsman_id == 325026, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Maxwell) %>% 
  summarise(avg_Maxwell = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Maxwell", 
				 avg = avg_Maxwell, 
				 batsman_partner = batsman_partner_Maxwell) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


	
dhoni <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 28081, 
                inning == 2, 
  							resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16  
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Dhoni = mean(diff), 
  					total = n()) %>% 
	mutate(batsman_partner_Dhoni = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 28081, 
                inning == 2, 
														resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Dhoni = if_else(batsman_id == 28081, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Dhoni) %>% 
  summarise(avg_Dhoni = mean(diff), 
  					total = n()) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Dhoni", 
				 avg = avg_Dhoni, 
				 batsman_partner = batsman_partner_Dhoni) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


russell <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 276298, 
                inning == 2, 
  							resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Russell = mean(diff)) %>% 
	mutate(batsman_partner_Russell = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 276298, 
                inning == 2, 
														resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Russell = if_else(batsman_id == 276298, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Russell) %>% 
  summarise(avg_Russell = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Russell", 
				 avg = avg_Russell, 
				 batsman_partner = batsman_partner_Russell) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))


pollard <-
  cricjam_data_big %>% 
  dplyr::filter(batsman_id %in% 230559, 
  							resources>10,
                inning == 2, 
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
                # over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr) %>% 
  group_by(bucketed_over) %>% 
  summarise(avg_Pollard = mean(diff)) %>% 
	mutate(batsman_partner_Pollard = "Partnership") %>% 
	bind_rows(cricjam_data_big %>% 
							dplyr::filter(batsman_id %in% 230559, 
                inning == 2, 
														resources>10,
                # batsman_balls_faced_this_match<16, 
                !is.infinite(required_run_rate), 
# over < 16,
                over >= 16 
                # batsman_balls_faced_this_match==1, 
                # year %in% c("2017", "2018", "2019", "20172018", "20182019", "2020", "20192020")
  ) %>% 
  distinct(match_id, bucketed_over) %>% 
  left_join(cricjam_data_big %>% 
              dplyr::filter(inning == 2, 
              							resources>10,
                            !is.infinite(required_run_rate), 
                            # over < 16,
                over >= 16 ), by = c("match_id" = "match_id", 
                                               "bucketed_over" = "bucketed_over")) %>% 
  group_by(bucketed_over, match_id) %>% 
  mutate(starting_rrr = first(required_run_rate), 
         ending_rrr = last(required_run_rate), 
         diff = ending_rrr-starting_rrr, 
  			 batsman_partner_Pollard = if_else(batsman_id == 230559, "Batsman", "Partner")) %>% 
  group_by(bucketed_over, batsman_partner_Pollard) %>% 
  summarise(avg_Pollard = mean(diff)) %>% 
  ungroup()) %>% 
	mutate(batsman_name = "Pollard", 
				 avg = avg_Pollard, 
				 batsman_partner = batsman_partner_Pollard) %>% 
	dplyr::select(c(batsman_name, avg, batsman_partner, bucketed_over))

pollard %>% 
	bind_rows(maxwell, dhoni, russell) %>%
	# dplyr::filter(bucketed_over <20) %>% 
	ggplot(aes(x = bucketed_over, y = avg, group = batsman_partner, color = batsman_partner)) +
  geom_smooth()+
  geom_hline(yintercept = 0)+
  labs(y = "Required Run Rate", 
       x = "Over", 
       title = "Change in Required Run Rate While Batting (or Partnering)", 
  		 color = "")+
  facet_wrap(~batsman_name)+
  theme_minimal()

```



It is clear in the data that while Dhoni is considered by many to be the worlds best closer, he is doing it in a unique counter intuitive way. While many would consider lowering the required run rate to be a priority, Dhoni and his partners consistently allow the required run rate to increase, however Dhoni is able to still bring his team home. This creates a dilemma for coaches, analysts and fans. Can their favourite player be a good closer if they try to bat like Dhoni? 






## Conclusion - Easier fan engagement

To the surprise of many, there has not been a real push to engage fans in the analytics of the game of cricket. Unlike other sports which has seen a boom through the use of accessible data like Ice Hockey, NFL, Baseball and Basketball for example.

Without an easy accessible medium how can crickets version of an analytics community grow.

We believe that access to the play-by-play data available to cricket analysts and teams is vital to create a strong cricket analytics community. Without access fans are forced to accept the statistics given by analytics teams like Cricviz, who have released contradictory statistics on players to a community without the access to verify the work. The waRne package is at the moment a tool for scraping games that are complete, and lacks the functionality to live scrape and update. However we believe this framework can be adapted for live scraping as well, to give fans the ultimate tools for engaging in the game of cricket.

\newpage
